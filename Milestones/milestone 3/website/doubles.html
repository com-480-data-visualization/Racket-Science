<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Data Visualization Project</title>
  <link rel="stylesheet" href="css/style.css">
  <style>
    #transition-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: white;
      z-index: 9999;
      display: none;
      overflow: hidden;
    }

    #bouncing-ball {
      position: absolute;
      width: 60px;
      height: 60px;
      z-index: 10000;
    }

    #drag-broom {
      position: fixed;
      bottom: 20px;
      left: -300px;
      height: 100px;
      z-index: 9998;
      display: none;
      transition: left 1s ease-in-out;
    }
  </style>
</head>
<body>
  <div id="transition-overlay">
    <img src="images/tennis-ball.png" id="bouncing-ball" />
  </div>
  <img src="images/drag-broom.png" id="drag-broom" />

  <nav>
    <ul class="width-limited">
      <li><a href="index.html">Global</a></li>
      <li><a href="doubles.html" class="active">Doubles</a></li>
      <li><a href="surfaces.html">Surfaces</a></li>
      <li><a href="services.html">Services</a></li>
      <li><a href="net.html">Net</a></li>
      <li><a href="tournament.html">Tournament</a></li>
      <li><a href="compare.html">Compare</a></li>
    </ul>
  </nav>

  <header>
    <h1>Doubles GOAT</h1>
  </header>

  <main class="charts-wrapper">
    <div class="top-charts" id="chart-swiper">
      <!-- Podium chart -->
      <section class="chart-container top-chart" id="podium">
        <!-- content omitted for brevity -->
      </section>

      <!-- Over the years chart -->
      <section class="chart-container top-chart" id="over_the_years">
        <!-- content omitted for brevity -->
      </section>

      <div class="nav-dots">
        <span class="dot" onclick="goToChart(1)"></span>
        <span class="dot active" onclick="goToChart(2)"></span>
      </div>
    </div>
  </main>

  <footer>
    <p>&copy; 2025 - We hope this site is an ace. Proudly served with love by RÃ©za Machraoui, Luna Ralet & Leila Sidjanski.</p>
  </footer>

  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src="js/main.js"></script>
  <script>
    // Tennis ball bounce transition
    const overlay = document.getElementById('transition-overlay');
    const ball = document.getElementById('bouncing-ball');

    function animateBounceAndNavigate(url) {
      overlay.style.display = 'block';

      let x = 0;
      let y = 0;
      let speed = 12;
      let angle = Math.random() * 2 * Math.PI;
      let vx = Math.cos(angle) * speed;
      let vy = Math.sin(angle) * speed;
      const ballSize = 60;
      const screenW = window.innerWidth;
      const screenH = window.innerHeight;

      const interval = setInterval(() => {
        x += vx;
        y += vy;

        if (x + ballSize >= screenW || x <= 0) vx *= -1;
        if (y + ballSize >= screenH || y <= 0) vy *= -1;

        ball.style.left = `${x}px`;
        ball.style.top = `${y}px`;
      }, 16);

      setTimeout(() => {
        clearInterval(interval);
        window.location.href = url;
      }, 2000);
    }

    document.querySelectorAll('a').forEach(link => {
      link.addEventListener('click', function (e) {
        const url = this.href;
        if (url.startsWith(window.location.origin)) {
          e.preventDefault();
          animateBounceAndNavigate(url);
        }
      });
    });

    // Swipe and broom logic
    const swiper = document.getElementById('chart-swiper');
    const broom = document.getElementById('drag-broom');
    let startX = 0;
    let endX = 0;

    swiper.addEventListener('touchstart', e => {
      startX = e.changedTouches[0].screenX;
    });

    swiper.addEventListener('touchend', e => {
      endX = e.changedTouches[0].screenX;
      handleSwipe();
    });

    function handleSwipe() {
      if (endX < startX - 50) {
        triggerBroom('left');
      } else if (endX > startX + 50) {
        triggerBroom('right');
      }
    }

    function triggerBroom(direction) {
      broom.style.display = 'block';
      broom.style.left = direction === 'left' ? '-300px' : '100vw';
      void broom.offsetWidth;
      broom.style.left = direction === 'left' ? '100vw' : '-300px';

      setTimeout(() => {
        broom.style.display = 'none';
        switchChart(); // TODO: Replace with your actual chart-switching logic
      }, 1000);
    }

    function switchChart() {
      // You can toggle chart visibility here
      console.log("Switched chart after broom swipe");
    }
  </script>
</body>
</html>
